<!doctype html>
<html lang="es" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Avisador Cripto - Dashboard</title>
    <style>
      :root {
        --bg: #0b0f1a;
        --bg-elev: #0f1524;
        --text: #e6e9ef;
        --muted: #97a1b2;
        --border: #1f2a44;
        --accent: #3b82f6;
        --good: #10b981;
        --bad: #ef4444;
        --pill-bg: #1e293b;
      }
      [data-theme="light"] {
        --bg: #f6f7fb;
        --bg-elev: #ffffff;
        --text: #101828;
        --muted: #667085;
        --border: #e5e7eb;
        --accent: #3b82f6;
        --pill-bg: #eef2f7;
      }
      @media (prefers-color-scheme: light) {
        html[data-theme="auto"] {
          --bg: #f6f7fb;
          --bg-elev: #ffffff;
          --text: #101828;
          --muted: #667085;
          --border: #e5e7eb;
          --accent: #3b82f6;
          --pill-bg: #eef2f7;
        }
      }
      * { box-sizing: border-box; }
      body {
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
        background: var(--bg);
        color: var(--text);
        margin: 0;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      .container { max-width: 1100px; margin: 0 auto; padding: 24px; }
      .topbar {
        display: flex; align-items: center; justify-content: space-between;
        padding: 16px 0 8px; position: sticky; top: 0; backdrop-filter: blur(6px);
      }
      .title { font-size: 18px; font-weight: 600; letter-spacing: .2px; }
      .muted { color: var(--muted); }
      .toggle {
        border: 1px solid var(--border); background: var(--bg-elev); color: var(--text);
        padding: 8px 12px; border-radius: 10px; cursor: pointer;
      }
      .grid { display: grid; gap: 16px; grid-template-columns: 1fr; }
      @media (min-width: 980px) { .grid { grid-template-columns: 1fr; } }
      .card {
        background: var(--bg-elev);
        border: 1px solid var(--border);
        border-radius: 14px;
        overflow: hidden;
      }
      .card h2 { font-size: 16px; padding: 14px 16px; margin: 0; border-bottom: 1px solid var(--border); }
      .card .content { padding: 12px 16px 16px; }

      table { border-collapse: collapse; width: 100%; }
      th, td { padding: 10px 12px; font-size: 14px; border-bottom: 1px solid var(--border); }
      th { text-align: left; color: var(--muted); font-weight: 600; position: sticky; top: 0; background: var(--bg-elev); }
      tr:hover td { background: rgba(59, 130, 246, 0.05); }
      tbody tr:nth-child(2n) td { background: rgba(255,255,255,0.02); }
      a { color: var(--accent); text-decoration: none; }
      a:hover { text-decoration: underline; }
      .pill { padding: 2px 8px; border-radius: 999px; background: var(--pill-bg); font-size: 12px; display: inline-block; }
      .score-high { background: rgba(16,185,129,.15); color: #22c55e; }
      .score-med { background: rgba(59,130,246,.15); color: #60a5fa; }
      .score-low { background: rgba(148,163,184,.15); color: #cbd5e1; }
      .tags { display: flex; flex-wrap: wrap; gap: 6px; }
      .tag { font-size: 12px; padding: 2px 8px; border-radius: 999px; border: 1px solid var(--border); background: var(--pill-bg); color: var(--text); }
      .tag-high { border-color: #22c55e55; }
      .tag-med { border-color: #60a5fa55; }
      .tag-low { border-color: #94a3b855; }
      .footer { color: var(--muted); font-size: 12px; padding: 16px 0; }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="topbar">
        <div class="title">Avisador Cripto <span class="muted">· Dashboard</span></div>
        <button class="toggle" id="themeToggle" title="Cambiar tema">Modo claro/oscuro</button>
      </div>

      <div class="grid">
        <section class="card">
          <h2>Watchlist</h2>
          <div class="content">
            <table>
              <thead>
                <tr>
                  <th>Network</th>
                  <th>Token/Par</th>
                  <th>Nota</th>
                </tr>
              </thead>
              <tbody>
                {% for w in watchlist %}
                <tr>
                  <td>{{ w.network }}</td>
                  <td>{{ w.tokenAddress or w.pairAddress }}</td>
                  <td>{{ w.note or '-' }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </section>

        <section class="card">
          <h2>Últimas alertas</h2>
          <div class="content">
            <table>
              <thead>
                <tr>
                  <th>Hora</th>
                  <th>Network</th>
                  <th>Par</th>
                  <th>Precio</th>
                  <th>Liquidez</th>
                  <th>Score</th>
                  <th>Razones</th>
                  <th>Enlace</th>
                </tr>
              </thead>
              <tbody>
                {% for a in alerts %}
                {% set score_class = 'score-low' %}
                {% if a.score >= 7 %}{% set score_class = 'score-high' %}{% elif a.score >= 5 %}{% set score_class = 'score-med' %}{% endif %}
                <tr>
                  <td data-ts="{{ a.ts }}">{{ a.ts }}</td>
                  <td>{{ a.network }}</td>
                  <td>{{ a.symbol }}</td>
                  <td>${{ '%.6f'|format(a.price_usd|float) if a.price_usd is not none else '-' }}</td>
                  <td>${{ '%.0f'|format(a.liquidity_usd|float) if a.liquidity_usd is not none else '-' }}</td>
                  <td><span class="pill {{ score_class }}">{{ a.score }}</span></td>
                  <td>
                    <div class="tags">
                      {% for t in a.reason_tags %}
                        <span class="tag {{ t.level }}" title="{{ t.detail }}">{{ t.label }}</span>
                      {% endfor %}
                    </div>
                  </td>
                  <td>{% if a.link %}<a href="{{ a.link }}" target="_blank">Ver</a>{% else %}-{% endif %}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </section>
      </div>

      <div class="footer">Hecho con FastAPI · Actualiza para recargar datos</div>
    </div>

    <script>
      // Toggle claro/oscuro
      const html = document.documentElement;
      document.getElementById('themeToggle').addEventListener('click', () => {
        const cur = html.getAttribute('data-theme') || 'dark';
        html.setAttribute('data-theme', cur === 'dark' ? 'light' : 'dark');
      });
      // Formatear timestamps (UNIX seconds) a hora local legible
      const formatTs = (s) => {
        const n = Number(s) * 1000;
        if (!Number.isFinite(n)) return s;
        const d = new Date(n);
        return d.toLocaleString();
      };
      document.querySelectorAll('[data-ts]').forEach(td => {
        td.textContent = formatTs(td.getAttribute('data-ts'));
      });
    </script>
  </body>
  </html>


